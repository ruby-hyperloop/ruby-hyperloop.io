<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>


    <!-- Opal and Hyperloop -->
    <script src="https://rawgit.com/ruby-hyperloop/hyperloop-js/master/opal-compiler.min.js"></script>
    <script src="https://rawgit.com/ruby-hyperloop/hyperloop-js/master/hyperloop.min.js"></script>

    <!-- If you want local copies... -->
    <!-- <script src="/javascripts/opal-compiler.js"></script> -->
    <!-- <script src="/javascripts/hyperloop.js"></script> -->

    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

    <script src="/javascripts/bootstrap.min.js"></script>
    <script src="/javascripts/codemirror.js"></script>
    <script src="/javascripts/ruby.js"></script>
    <script src="/javascripts/matchbrackets.js"></script>
    <script src="/javascripts/react_player.js"></script>

    <!-- Components are compiled by Hyperloop Express -->
    <script type="text/ruby">

class CodeMirror < Hyperloop::Component
  param :code, type: String
  param :heading, default: "Code"
  param :rows, type: Integer, default: 0
  param :top_level_component, type: String

  before_mount do
    r=rand(2**256).to_s(36)[0..7]
    @div_code = "code_#{r}"
    @div_result = "result_#{r}"
  end

  after_mount do
  puts params.code
    @editor = `CodeMirror(document.getElementById(#{@div_code}), {
      value: #{params.code.to_s},
      mode: 'text/x-ruby',
      matchBrackets: true,
      lineNumbers: true,
      indentUnit: 2,
      theme: 'github'
    });`

    `#{@editor}.on('change', #{lambda {on_change} })`
    `#{@editor}.setSize(null, #{@editor}.defaultTextHeight()*#{params.rows})` unless params.rows == 0
    execute_code
  end

  render(DIV) do
    div.card {
      div.card_header { params.heading }
      div(id: @div_code)
      div.card_header do
        img(src:'../images/hyperloop-logo-small-white.png', width:'25')
        span { ' ' }
        'Hyperloop playground :'
      end
      div.card_block(id: @div_result)
    }
  end

  def on_change
    execute_code
  end

  def execute_code
    begin
      code = `#{@editor}.getValue()`
      puts code
      code += "\nElement['##{@div_result}'].render(#{params.top_level_component})"
      compiled_code = Opal::Compiler.new(code).compile
      Hyperloop::Context.reset!
      `ReactDOM.unmountComponentAtNode(document.getElementById(#{@div_result}));`
      `eval(#{compiled_code})`
      component = Module.const_get params.top_level_component
      # we need to see if the component is valid - try checking if it can render static markup
      # the following line generates: `undefined method to_n for SimpleComponent`
      # if React.render_to_static_markup( component ).empty?
      #   invalid_component_message
      # end
    rescue Exception => e
      @time_out = after(0.1) do
        unable_to_compile_message e.message
      end
    end
  end

  def invalid_component_message
    message = div.text_danger do
      h3.text_danger {"Oops, invalid Component..."}
      p { "Your Component has been rejected by React. A valid Component must have a render macro and return just one HTML element." }
    end
    Element["##{@div_result}"].render{ message }
  end

  def unable_to_compile_message reason
    message = div.text_danger do
      h3.text_danger {"Can't compile..."}
      p { reason }
    end
    Element["##{@div_result}"].render{ message }
  end

end

</script>

    <script type="text/ruby">

Document.ready? do
   Element.find('div.codemirror-live-edit').each do |mount_point|
     heading = mount_point.attr('data-heading')
     rows = mount_point.attr('data-rows')
     top_level_component = mount_point.attr('data-top-level-component')
     code = Element[mount_point].find('pre').text.strip
     params = {code: code, top_level_component: top_level_component}
     params = params.merge({heading: heading}) if heading
     params = params.merge({rows: rows.to_i}) if rows
     codemirror_component = Object.const_get('CodeMirror')
     React.render(React.create_element(codemirror_component, params ), mount_point)
   end
end

</script>


    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="/stylesheets/typography.css" rel="stylesheet" />
    <link href="/stylesheets/override.css" rel="stylesheet" />
    <link href="/stylesheets/divtable.css" rel="stylesheet" />
    <!-- <link href="/stylesheets/code.css" rel="stylesheet" /> -->
    <link href="/stylesheets/github.css" rel="stylesheet" />
    <link href="/stylesheets/highlighting.css" rel="stylesheet" />
    <link href="/stylesheets/codemirror.css" rel="stylesheet" />

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/manifest.json">
    <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#e81176">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
    <div class="navbarbackgroundcolor">
      <div class="container">
        <nav class="navbar navbar-ligh">
  <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a href="/" class="nav-link">Hyperloop</a>
      </li>
      <li class="nav-item">
        <a href="/start" class="nav-link active">Start</a>
      </li>
      <li class="nav-item">
        <a href="/installation" class="nav-link">Installation</a>
      </li>
      <li class="nav-item">
        <a href="/tutorials" class="nav-link">Learn</a>
      </li>
      <li class="nav-item">
        <a href="/gems" class="nav-link">Gems</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/ruby-hyperloop" class="nav-link">Github</a>
      </li>
      <li class="nav-item">
        <a href="/tools" class="nav-link">Tools</a>
      </li>
      <li class="nav-item">
        <a href="/docs/architecture" class="nav-link">Docs</a>
      </li>
      <li class="nav-item">
        <a href="/support" class="nav-link">Help</a>
      </li>
      <li class="nav-item">
        <a href="/blog" class="nav-link">Blog</a>
      </li>
    </ul>
  </div>
</nav>

      </div>
    </div>

    <div class="jumbotron page-header">
      <div class="container">
        <div class="row hidden-xs-down">
          <div class="col-md-2">
            <div class="hyperlooplogo">
            </div>
          </div>
          <div class="col-md-10">



            <h1 class="display-4 project-name">Hyperloop</h1>

            <h4 class="display-7 project-tagline">
              The Complete Isomorphic Ruby Framework
            </h2>
          </div>
        </div>
        <div class="row hidden-sm-up">
          <div class="col-md-3 center-text">
            <img src="/images/hyperloop-logo-small-white.png" width="100" alt="Hyperloop logo small white" />
          </div>
          <div class="col-md-9">
            <h1 class="h1 project-name center-text">Hyperloop</h1>
            </br>
            <h2 class="h5 project-tagline center-text">
              The Complete Isomorphic Ruby Framework
            </h2>
          </div>
        </div>
      </div>
    </div>

    <div class="page-header-underline">
      <div class="container">

      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-3 sidenavcol">
            <ul class="nav">
    <li class="nav-item"><a href="/start#components">Components</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/start#rendering-components">Rendering Components</a></li>
      <li class="nav-item"><a href="/start#passing-paramaters">Passing Paramaters</a></li>
      <li class="nav-item"><a href="/start#state-and-conditional-execution">State and conditional execution</a></li>
      <li class="nav-item"><a href="/start#stylish-components">Stylish Components</a></li>
      <li class="nav-item"><a href="/start#using-javascript-libraries">Using JavaScript Libraries</a></li>
    </ul>

    <br>
    <li class="nav-item"><a href="/start#stores">Stores</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/start#overloaded-components">Overloaded Components</a></li>
      <li class="nav-item"><a href="/start#using-stores">Using Stores</a></li>
    </ul>
    <br>
    <li class="nav-item"><a href="/start#models">Models</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/start#activerecord-models">Active Record Models</a></li>
      <li class="nav-item"><a href="/start#hyperloop-models">Hyperloop Models</a></li>
    </ul>

    <br>
    <li class="nav-item"><a href="/start#operations">Operations</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/start#operations-and-stores">Operations and Stores</a></li>
      <li class="nav-item"><a href="/start#ispatchers-and-receivers">Dispatchers and Receivers</a></li>
      <li class="nav-item"><a href="/start#server-operations">Server Operations</a></li>
    </ul>

    <br>
    <li class="nav-item"><a href="/start#policies">Policies</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/start#using-policies">Using Policies</a></li>
    </ul>

    <br>
    <li class="nav-item"><a href="/start#pragmatic-thinking">Pragmatic Thinking</a></li>
  </ul>


          <br>
        </div>
        <div class="col-md-9 main-content">
          <h1 id="getting-started-with-hyperloop">Getting Started with Hyperloop</h1>

<p>This introduction will take you through most of what you need to know to get started with Hyperloop. There are live code examples, so please feel free to experiment as you read.</p>

<p>There are five important ingredients to the Hyperloop architecture (COMPS for short):</p>

<div class="startpageTable">
  <div class="divTable">
    <div class="divTableBody">
      <div class="divTableRow">
        <div class="divTableCell first">
          <img src="/images/HyperComponents.png" width="170" alt="Hypercomponents" />
        </div>
        <div class="divTableCell second">
          <b>Components</b> describe how the UI will display the current application state and how it will handle user actions.  Using React, Components automatically rerender parts of the display as state changes due to local or remote activities.
        </div>
      </div>
      <div class="divTableRow">
        <div class="divTableCell">
          <img src="/images/HyperStores.png" width="170" alt="Hyperstores" />
        </div>
        <div class="divTableCell">
          <b>Stores</b> hold the local application state. Stores are Ruby classes that keep the dynamic parts of the state in special state variables. We use Stores to share state between Components.
        </div>
      </div>
      </div>
      <div class="divTableRow">
        <div class="divTableCell">
          <img src="/images/HyperModels.png" width="170" alt="Hypermodels" />
        </div>
        <div class="divTableCell">
          Your ActiveRecord <b>Models</b> are available in your Isomorphic code. Components, Operations, and Stores have CRUD access to your server side Models, using the standard ActiveRecord API. Amazingly, we automatically synchronize data between connected clients.
      </div>
      </div>
      <div class="divTableRow">
        <div class="divTableCell">
          <img src="/images/HyperOperations.png" width="170" alt="Hyperoperations" />
        </div>
        <div class="divTableCell">
          <b>Operations</b> encapsulate business logic. In a traditional MVC architecture, Operations end up either in Controllers, Models or some other secondary construct such as service objects, helpers, or concerns. Here they are first class objects. Their job is to mutate state in the Stores and Models.
        </div>
      </div>
      <div class="divTableRow">
        <div class="divTableCell">
          <img src="/images/HyperPolicies.png" width="170" alt="Hyperpolicies" />
        </div>
        <div class="divTableCell">
          <b>Policies</b> keep authorization logic out of Models, and Operations, and also allows the isomorphic transport mechanism to know what and when to communicate between client and server.
        </div>
      </div>
  </div>
</div>

<p>This Getting Started guide will introduce you to Hyperloop. After reading this you might like to try some of the <a href="/tutorials">Tutorials</a> or jump into the <a href="/docs/architecture">Docs</a> for a comprehensive overview of the Hyperloop architecture.</p>

<hr>

<h2><div class="hyperlogoalone" id="components"><img src="/images/HyperComponents.png" width="35" alt="Hypercomponents" /></div>
Components
</h2>

<p>Hyperloop user interfaces are composed of React Components written in Ruby.</p>

<p>Here is the basic structure of a Component:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">StrippedBackComponent</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span><span class="p">(</span><span class="no">DIV</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>As you can see, a Component is just a Ruby class which inherits from <code>React::Component::Base</code>. At a minimum, a Component must implement a <code>render</code> macro that returns just one HTML element. Under the covers, HyperReact uses Opal to compile this Component into JavaScript then hands it to React to mount as a regular JavaScript React Component.</p>

<p>As with React, there are no templates in Hyperloop, your user interface is made up of Components which mix conditional logic and HTML elements to build the user interface. Unlike React, where you code in JSX and JavaScript, Hyperloop lets you keep all your code in Ruby.</p>

<p>Let&#39;s add a little functionality to this Component - you can edit this code if you would like to experiment.</p>

<div class="codemirror-live-edit"
  data-heading="A simple Component rendering a Button"
  data-rows=9
  data-top-level-component="SimpleComponent">
<pre>
class SimpleComponent < Hyperloop::Component
  state show_field: false
  render(DIV) do
    BUTTON { 'Push the button' }.on(:click) do
     alert 'You did it!'
    end
  end
end
</pre></div>

<p>There are a few things to notice in the code above.</p>

<ul>
<li>Every Component must have a <code>render</code> macro which must return just one HTML element. The syntax of <code>render(DIV)</code> is a shorthand for this which will return one div.</li>
<li>HTML elements (DIV, BUTTON, etc) can be in uppercase or lowercase.</li>
<li>We added an event handler to the button. You can do this for any HTML element in the same way.</li>
</ul>

<h3 id="rendering-components">Rendering Components</h3>

<p>Hyperloop&#39;s architecture encourages you to write simple Components that perform single tasks and render other Components.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span><span class="p">(</span><span class="no">DIV</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">MainNavigation</span> <span class="p">{}</span>
    <span class="no">PageContents</span> <span class="p">{}</span>
    <span class="no">Footer</span> <span class="p">{}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>This simple approach allows you to build complicated user interfaces yet encapsulate functionality into reusable contained entities.</p>

<h3 id="passing-parameters">Passing parameters</h3>

<p>Data is passed downward from a parent Component to its children. There are various techniques for passing data upward and (better still) keeping data in <strong>Stores</strong> independently of Components but we will address that later.</p>

<p>For now, let&#39;s experiment with passing parameters:</p>

<div class="codemirror-live-edit"
  data-heading="Passing parameters"
  data-top-level-component="MeeterGreeter">
<pre>
class MeeterGreeter < Hyperloop::Component
  render(DIV) do
    SayHelloTo(name: "John")
    SayHelloTo(name: "Sally")
  end
end

class SayHelloTo < Hyperloop::Component
  param :name, type: String

  render(DIV) do
    H4 { "Hello #{params.name}!" }
  end
end
</pre></div>

<p>You will notice a couple of things in the code above:</p>

<ul>
<li>The syntax for adding components is either <code>MyComponent()</code> or <code>MyComponent {}</code> but never just <code>MyComponent</code>. Sometimes you use both - <code>button(style: default) { &quot;Click Me&quot; }</code>. Everything in the brackets is passed to the Component as a parameter and everything in the curly brace is rendered within the Component.</li>
<li>Parameters can be strongly typed <code>param :name, type: String</code> and considering this code will be compiled to JavaScript this is a good idea.</li>
</ul>

<h3 id="state-and-conditional-execution">State and Conditional Execution</h3>

<p>One of the greatest things about React is that it encourages you to write code in a declarative way with Components that manage their own state. As state changes, React works out how to render the user interface without you having to worry about the DOM. As state changes, the user interface re-renders itself.</p>

<p>Lets experiment with an example:</p>

<div class="codemirror-live-edit"
  data-heading="Using state"
  data-rows=30
  data-top-level-component="StateExample">
<pre>
class StateExample < Hyperloop::Component
  state show_field: false
  state field_value: ""

  render(DIV) do
    show_button
    DIV do
      show_input
      H1 { "#{state.field_value}" }
    end if state.show_field
  end

  def show_button
    BUTTON do
      state.show_field ? "Hide" : "Show"
    end.on(:click) { state.show_field! !state.show_field }
  end

  def show_input
    BR {}
    INPUT(type: :text).on(:change) do |e|
      state.field_value! e.target.value
    end
  end

  def show_text
    H1 { "#{state.field_value}" }
  end
end</pre></div>

<p>A few things to notice in the code above:</p>

<ul>
<li>We define state using the <code>state</code> macro. Notice how we set the initial value.</li>
<li>To reference state we use <code>state.something</code> and <code>state.mutate.something =</code> (or previously <code>state.something!</code>) is used to update state</li>
<li>Components are just Ruby classes which have methods.</li>
<li>Here is the most important part - notice how React automatically updates the user interface as state changes. This is the very heart of React thinking.</li>
</ul>

<h3 id="stylish-components">Stylish Components</h3>

<p>Conditional logic, HTML elements, state and style all intermingle in a Hyperloop Component. This website uses Bootstrap CSS, so we have complete access to the Bootstrap CSS from within our Components.</p>

<div class="codemirror-live-edit"
  data-heading="Using CSS"
  data-rows=23
  data-top-level-component="StylishTable">
<pre>
class StylishTable < Hyperloop::Component
  render(DIV) do
    table.table.table_bordered do
      thead do
        tr do
          th { "First Name" }
          th { "Last Name" }
          th { "Username" }
          th { }
        end
      end
      tbody do
        tr do
          td { "Mark" }
          td { "Otto" }
          td.text_success { "@odm" }
          td { button.btn.btn_primary.btn_sm { "Edit" } }
        end
      end
    end
  end
end</pre></div>

<p>As you can see above, CSS is mixed into HTML elements. <code>div.something</code> becomes <code>&lt;div class=&quot;something&quot;&gt;</code>. Also note that <code>btn-primary</code> becomes <code>btn_primary</code> as &#39;-&#39; is disallowed in Ruby.</p>

<h3 id="using-javascript-libraries">Using JavaScript Libraries</h3>

<p>As a final point on Components, it is important to understand that Hyperloop gives you full access to <strong>all JavaScript libraries and components from directly within your Ruby code.</strong> Everything you can do in JavaScript is simple to do in ruby, this includes passing parameters between Ruby and JavaScript and even passing in Ruby lambdas as JavaScript callbacks. All of this magic comes from Opal.</p>

<p>JavaScript components are accessed directly from within your Ruby code. We have a tutorial which will show you exactly how this works.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">ExampleComponent</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span><span class="p">(</span><span class="no">DIV</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">ReactPlayer</span><span class="p">(</span><span class="ss">url:  </span><span class="s1">'https://www.youtube.com/embed/FzCsDVfPQqk'</span><span class="p">,</span>
      <span class="ss">playing: </span><span class="kp">false</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>That concludes the introduction to Components. To learn more about Components please see the <a href="/tutorials">Tutorials</a> and also the comprehensive <a href="/docs/architecture">Docs</a></p>

<hr>

<h2><div class="hyperlogoalone" id="stores"><img src="/images/HyperStores.png" width="35" alt="Hyperstores" /></div>
Stores
</h2>

<p>Hyperloop Stores (similar to Flux Stores) exist to hold local application state. Components read state from Stores and render accordingly. This separation of concerns is an improvement in the overall architecture and makes our application easier to maintain.</p>

<p><strong>Why would we have Stores?</strong> Let&#39;s examine that question through an example.</p>

<h3 id="overloaded-components">Overloaded Components</h3>

<p>Take the simple Component below which displays an initial discount then gives the user the option of taking a once only &#39;Lucky Dip&#39; that will either increase or decrease their discount.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">OfferLuckyDip</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">state</span> <span class="ss">discount: </span><span class="mi">30</span>
  <span class="n">state</span> <span class="ss">lucky_dip_taken: </span><span class="kp">false</span>

  <span class="k">def</span> <span class="nf">render</span>
    <span class="no">DIV</span> <span class="k">do</span>
      <span class="no">H1</span> <span class="p">{</span><span class="s2">"Your discount is </span><span class="si">#{</span><span class="n">state</span><span class="p">.</span><span class="nf">discount</span><span class="si">}</span><span class="s2">%"</span><span class="p">}</span>
      <span class="no">BUTTON</span> <span class="p">{</span> <span class="s2">"Lucky Dip"</span> <span class="p">}.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">state</span><span class="p">.</span><span class="nf">discount!</span> <span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="nf">discount</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">.</span><span class="nf">.</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">state</span><span class="p">.</span><span class="nf">lucky_dip_taken!</span> <span class="kp">true</span>
      <span class="k">end</span> <span class="k">unless</span> <span class="n">state</span><span class="p">.</span><span class="nf">lucky_dip_taken</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>The Component will work as expected but there are two fundamental problems with this pattern:</p>

<ul>
<li>Firstly, the discount (state) is tied to the Component itself. This is a problem as we might have other Components on the page which need to also see and interact with the discount. <strong>We need a better place than in our Components to keep application state.</strong></li>
<li>Our business logic (discounts start at 30% and the lucky dip increases or decreases by 5%) is all wrapped up with our presentational code. This makes our application fragile and difficult to evolve. <strong>Our application logic should be separate from our display logic.</strong></li>
</ul>

<p>We will fix these problems but first implementing a Hyperloop Store to keep our application state and business logic out of our Components. Later in this guide we will go one step further and move our business logic out of the Store into an Operation but for now the first step will be a big improvement.</p>

<h3 id="using-stores">Using Stores</h3>

<p>First let&#39;s add the Store:</p>

<p>You will notice a few things in the code above:</p>

<ul>
<li>A Store is a ruby class derived from <code>Hyperloop::Store</code></li>
<li>We have added two state variables which are both scoped to be class variables meaning that we will only have one instance of this class</li>
<li>Similarly the <code>lucky_dip!</code> method is a class method</li>
<li>Notice how we use <code>mutate</code> to change the value of a state variable.</li>
</ul>

<p>Next we will refactor our Component to use the Store:</p>

<div class="codemirror-live-edit"
  data-heading="An overloaded Component"
  data-rows=22
  data-top-level-component="OfferLuckyDip">
<pre>
class Discounter < Hyperloop::Store
   state discount: 30, scope: :class, reader: true
   state lucky_dip_taken: false, scope: :class, reader: true

  def self.lucky_dip!
    mutate.discount( state.discount + rand(-5..5) )
    mutate.lucky_dip_taken true
  end
end

class OfferLuckyDip < Hyperloop::Component
  def render
    DIV do
      H1 {"Your discount is #{Discounter.discount}%"}
      BUTTON { "Lucky Dip" }.on(:click) do
        Discounter.lucky_dip!
      end unless Discounter.lucky_dip_taken
    end
  end
end
</pre></div>

<ul>
<li>Notice that we do not create an instance of the Discounter class but instead access the class methods of the Store <code>Discounter.lucky_dip!</code> so that all Components will be using the same &#39;class instance&#39; of the Store.</li>
<li><code>Discounter.discount</code> is a reader class method that was added to the Store for us by <code>state discount: 30, scope: :class, reader: true</code> which saved us a lot of typing!</li>
<li>Components that read a Store&#39;s state will automatically update when the state changes.</li>
</ul>

<p>Stores can also receive dispatches from Operations - we will come to that later in this overview. In Hyperloop it is perfectly legitimate to interact with a Store through its class methods as we have done above.</p>

<p>That concludes the introduction to Stores. To learn more about Stores please see the <a href="/tutorials">Tutorials</a> and also the comprehensive <a href="/docs/architecture">Docs</a></p>

<hr>

<h2><div class="hyperlogoalone" id="models"><img src="/images/HyperModels.png" width="35" alt="Hypermodels" /></div>
Models
</h2>

<p>Hyperloop Models give your access to your server side Rails ActiveRecord Models from the client. In addition, Hyperloop implements push notifications (via a number of possible technologies) so changes to records on the server are dynamically pushed to all authorized clients.</p>

<ul>
<li>No need for a boilerplate API just to move JSON between the client and server</li>
<li>Changes are automatically synchronized between connected clients</li>
<li>You do not need to maintain one Model for the server and one Model for the client</li>
</ul>

<p><strong>One set of Models used by the client and the server code. Isomorphic Ruby in action.</strong></p>

<p>Models act like Stores in that they contain state, which is linked to the underlying ActiveRecord Models on the server. Changes make to the server-side Models are pushed to the client depending on the configured Policy for the current user.</p>

<h3 id="activerecord-models">ActiveRecord Models</h3>

<p>Our Models are linked to ActiveRecord Models so for this part of the Hyperloop architecture we have a dependancy on Rails and Active Record. If you are not using Rails you can still take advantage of Hyperloop&#39;s Components &amp; Stores (which do not depend on Rails) to create stunning interactive user interfaces.</p>

<p>Let&#39;s assume we have an ActiveRecord Model called Books:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Book</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
<span class="k">end</span>
</code></pre>
<h3 id="hyperloop-models">Hyperloop Models</h3>

<p>Your ActiveRecord Models are accessible in your client-side code as simply as this:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">BookList</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span><span class="p">(</span><span class="no">UL</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Book</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">book</span><span class="o">|</span>
      <span class="no">LI</span> <span class="p">{</span> <span class="s2">"</span><span class="si">#{</span><span class="n">book</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p><strong>No boilerplate API, no serialisation, no de-serialisation.</strong> Much like Relay and GraphQL, when rendering, Hyperloop parses through each Component and establishes which fields are necessary then queries just for those fields which are returned as JSON and then inserted into each Component. The key difference with Relay is that both the client and server code is provided by Hyperloop so the entire process is seamless for the developer.</p>

<p>Hyperloop has a few important advantages over Relay and GraphQL:</p>

<ul>
<li>Hyperloop is fully integrated with Rails out the box, so there is no need to build and maintain a GraphQL server or an API.</li>
<li>Your server side Models are available to your client side code, so there is no need to recreate an abstracted version of the Models client-side.</li>
<li>Unlike Relay and GraphQL, Hyperloop has built in push notifications to magically push changes to underlying server-side Models to any connected client with a Component rendering that Model</li>
<li>Access to Models and synchronized changes are controlled neatly by Policy classes</li>
<li>Just like Relay and GraphQL, only the records needed to render Components are transferred</li>
<li>Everything in beautiful, simple Ruby!</li>
</ul>

<hr>

<h2><div class="hyperlogoalone" id="operations"><img src="/images/HyperOperations.png" width="35" alt="Hyperoperations" /></div>
Operations
</h2>

<p>In a traditional MCV architecture, there is no defined place to keep business logic. You can overload your Controllers, Views or Models and unless you follow a defined pattern like Trailblazer you generally end up with your business logic all over the place. Our vision of building a &#39;Complete Ruby Isomorphic Framework&#39; meant that we had to address that problem head on, so we created Operations.</p>

<p>The design of our Operations has been inspired by a few sources:</p>

<ul>
<li>We liked the way the <a href="https://github.com/cypriss/mutations">Mutations Gem</a> handles parameters and validation</li>
<li><a href="https://github.com/trailblazer/trailblazer#operation">Trailblazer</a> inspired the idea of Operations and we like the <code>step</code> method</li>
<li>The <a href="https://facebook.github.io/flux/">Flux</a> pattern taught us that unidirectional data flow is a good idea and Stores should be able to <code>receive</code> dispatches from Operations.</li>
</ul>

<p><strong>Operations execute on the clients or the server.</strong> This simple principal radically simplifies application design and testing.</p>

<p>To demonstrate the power of Operations and the various ways in which you can use them, we are going to use three use case example and employ Operations in three different ways:</p>

<h3 id="operations-and-stores">Operations and Stores</h3>

<p>Firstly we will create a ShoppingCart Store and mutate the Store&#39;s data through methods on the Store, much like we did in the Store discount example above, but improved by adding an Operation to the Store&#39;s namespace.</p>

<p>Stores hold state and Operations mutate a Store&#39;s state. In the Store section above, we demonstrated how a class method on the Store could be used to mutate the state. In this example, we will go one further and add an Operation to the Store&#39;s namespace:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">ShoppingCart</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Store</span>
  <span class="n">state</span> <span class="ss">items: </span><span class="p">[],</span> <span class="ss">scope: :class</span><span class="p">,</span> <span class="ss">reader: </span><span class="kp">true</span>

  <span class="k">class</span> <span class="nc">AddItem</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Operation</span>
    <span class="n">validate</span><span class="p">(</span> <span class="o">!</span><span class="n">state</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">item</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">step</span><span class="p">(</span> <span class="n">mutate</span><span class="p">.</span><span class="nf">items</span> <span class="o">&lt;&lt;</span> <span class="n">params</span><span class="p">.</span><span class="nf">item</span> <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>You will notice in the code above:</p>

<ul>
<li>The AddItem Operation is included in the ShoppingCart Store&#39;s namespace. To invoke this Operation would would use <code>ShoppingCart.AddItem(items: item)</code></li>
<li>Notice how we validate the incoming params. If <code>validate</code> returns falsy then th OPeration</li>
</ul>

<h3 id="dispatchers-and-receivers">Dispatchers and Receivers</h3>

<p>Next we will write an Operation for login the user out which will dispatch a message that our ShoppingCart will receive. This will be following a Flux pattern.</p>

<p><strong>All Operations dispatch but it up to a Store to receive a dispatch.</strong> We have implemented the Flux pattern into Operations and Stores. Operations are dispatchers and Stores are receivers.</p>

<p>XXX</p>

<h3 id="server-operations">Server Operations</h3>

<p>There are some Operations that simply do not make sense to run on the client as (for example) the resources they depend on may not be available on the client. Consider an Operation that needs to send an email - there is no mailer on the client so the Operation has to execute from the server.</p>

<p>That said, with our highest goal being developer productivity, it should be as invisible as possible to the developer where the Operation will execute. To complete the example, a developer writing front-end code should be able to invoke a server-side resource (like a mailer) just as easily as they might invoke a client-side resource.</p>

<p><strong>ServerOps execute only on the server but are invokable from your Isomorphic code</strong> No need for boilerplate APIs just to execute a server side Operation. ServerOps are just like any normal Operations and invokable from any part of your code.</p>

<p>Finally we will use a server Operation to sign a user up to a mailing list and send them an email. This will show how to use ServerOps and also how <code>step</code> works.</p>

<p>XXX</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Discounter</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Store</span>
   <span class="n">state</span> <span class="ss">discount: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">scope: :class</span><span class="p">,</span> <span class="ss">reader: </span><span class="kp">true</span>
   <span class="n">state</span> <span class="ss">lucky_dip_taken: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">scope: :class</span><span class="p">,</span> <span class="ss">reader: </span><span class="kp">true</span>

  <span class="c1"># Note these two lines are essentially "noise" at this point, however</span>
  <span class="c1"># they will future proof the API.    They also provide a very clear declaration</span>
  <span class="c1"># of the API.</span>
  <span class="k">class</span> <span class="nc">LuckyDip</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Operation</span><span class="p">;</span> <span class="k">end</span>
  <span class="k">class</span> <span class="nc">Bumper</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Operation</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># we can take advantage of the way Ruby deals with classes and close the the</span>
<span class="c1"># class definition above as the 'public' interface, and open the class up in another</span>
<span class="c1"># file (if we want)</span>

<span class="k">class</span> <span class="nc">Discounter</span>

  <span class="c1"># likewise because Operations are classes we can open them up here and add implementation:</span>

  <span class="k">class</span> <span class="nc">LuckyDip</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Operation</span>
    <span class="n">outbound</span> <span class="ss">:dip_or_slip</span>
    <span class="n">validate</span> <span class="p">{</span> <span class="o">!</span><span class="no">Discounter</span><span class="p">.</span><span class="nf">lucky_dip_taken</span> <span class="p">}</span>
    <span class="nb">fail</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s1">'**** attempted to take two lucky dips *****'</span> <span class="p">}</span>
    <span class="n">step</span> <span class="p">{</span> <span class="n">params</span><span class="p">.</span><span class="nf">dip_or_slip</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">.</span><span class="nf">.</span><span class="mi">5</span><span class="p">)</span> <span class="p">}</span>
    <span class="c1"># or for more fun we could of course make it a ServerOp and grab the lucky dip based on</span>
    <span class="c1"># some global algorithm ensuring the luck dip average across all users 0</span>
  <span class="k">end</span>

  <span class="n">receives</span> <span class="no">LuckyDip</span> <span class="k">do</span> <span class="o">|</span><span class="n">params</span><span class="o">|</span>
    <span class="n">mutate</span><span class="p">.</span><span class="nf">discount</span><span class="p">(</span> <span class="n">state</span><span class="p">.</span><span class="nf">discount</span> <span class="o">+</span> <span class="n">params</span><span class="p">.</span><span class="nf">dip_or_slip</span> <span class="p">)</span>
    <span class="n">mutate</span><span class="p">.</span><span class="nf">lucky_dip_taken</span> <span class="kp">true</span>
  <span class="k">end</span>

  <span class="n">receives</span> <span class="no">Bumper</span> <span class="k">do</span>
    <span class="n">mutate</span><span class="p">.</span><span class="nf">discount</span><span class="p">(</span> <span class="n">state</span><span class="p">.</span><span class="nf">discount</span> <span class="o">*</span> <span class="mi">10</span> <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">OfferLuckyDip</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="no">DIV</span> <span class="k">do</span>
      <span class="no">H1</span> <span class="p">{</span><span class="s2">"Your discount is </span><span class="si">#{</span><span class="no">Discounter</span><span class="p">.</span><span class="nf">discount</span><span class="si">}</span><span class="s2">%"</span><span class="p">}</span>
      <span class="no">BUTTON</span> <span class="p">{</span> <span class="s2">"Lucky Dip"</span> <span class="p">}.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
        <span class="no">Discounter</span><span class="o">::</span><span class="no">LuckyDip</span><span class="p">.</span><span class="nf">run</span> <span class="c1"># note should be able to say Discounter::LuckyDip() but there is a bug :-)</span>
      <span class="k">end</span> <span class="k">unless</span> <span class="no">Discounter</span><span class="p">.</span><span class="nf">lucky_dip_taken</span>
    <span class="k">end</span>
    <span class="no">BUTTON</span> <span class="p">{</span> <span class="s2">"Bump"</span> <span class="p">}.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
      <span class="no">Discounter</span><span class="o">::</span><span class="no">Bumper</span><span class="p">.</span><span class="nf">run</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>


</code></pre>
<hr>

<h2><div class="hyperlogoalone" id="policies"><img src="/images/HyperPolicies.png" width="35" alt="Hyperpolicies" /></div>
Policies
</h2>

<p>TODO</p>

<h2 id="pragmatic-thinking">Pragmatic Thinking</h2>

<p>Hyperloop provides all the architectural constructs you need for a well designed, modern web application but we are <strong>not strongly opinionated</strong> as to how you use it. We would like you to find your own way through this architecture, to use the parts that make the most sense for your application and coding style. Here are a few pragmatic pointers which might help you:  </p>

<ul>
<li>If state is only mutated inside of a Component then leave it as a state in the Component. For example a state that is tracking the current value of some input.</li>
<li>Otherwise if it is a single application wide state object (like a cart), then use a Store, and group Operations in the Store&#39;s namespace.</li>
<li>Otherwise if you are going to have instances of the state (like you have a Store that manages a random feed of objects like tweets, github users etc) then use a Store and add accessor, and mutators to the store&#39;s API. Those methods may need Operations (which can be name spaced inside the store) to deal with APIs, server side code etc.</li>
</ul>

<p><strong>Why?</strong></p>

<ul>
<li>because its simple... don&#39;t use Stores, Operations, or anything else if you don&#39;t need to. Don&#39;t unnecessarily expose internals of a Component.</li>
<li>because you want to centralize Stores, and using Operations to mutate the store provides a consistent interface to the outside. If mutating the Store becomes more complex the power of the Operation can be used without an API change.</li>
<li>because in this case trying to use Operations becomes more cumbersome than its worth. You would have to pass the instance variable around to the Operation and simple things like <code>tweet_feed.next!</code> and <code>tweet_feed.avatar</code> would look like <code>StreamStore::Next(feed: tweet_feed)</code> and <code>StreamStore.avatar(tweet_feed)</code>.</li>
<li>So in this case since you are building more complex Store its reasonable to hide the Operation (which will still exist) in side the <code>StreamStore#next!</code> method</li>
</ul>

<hr>

<h3 id="welcome-aboard">Welcome aboard!</h3>

<p>We hope you have enjoyed this introduction to Hyperloop. As a next step, perhaps try some of the <a href="/tutorials">Tutorials</a> or jump into the <a href="/docs/architecture">Docs</a> for a comprehensive overview of the Hyperloop architecture.</p>

<h1 id="todo-find-somewhere-for-this">Todo find somewhere for this</h1>

<ul>
<li>class MyConfig &lt; Hyperloop</li>
<li>class MyComponent &lt; Hyperloop::Component</li>
<li>class MyOperation &lt; Hyperloop::Operation</li>
<li>class MyModel &lt; Hyperloop::Model</li>
<li>class MyPolicy &lt; Hyperloop::Policy</li>
<li>class MyStore &lt; Hyperloop::Store</li>
</ul>

        </div>
      </div>
    </div>

    <div class="page-footer-upperline">
      <div class="container">

      </div>
    </div>

    <footer class="nav-footer">
  <section class="sitemap">

    <a href="/" class="nav-home"></a>
    
    <div>
      <h6><a href="/start">Start</a></h6>
      <a href="/start#components">Components</a>
      <a href="/start#stores">Stores</a>
      <a href="/start#operations">Operations</a>
      <a href="/start#policies">Policies</a>
    </div>
    <div>
      <h6><a href="/tutorials">Learn</a></h6>
      <a href="/tutorials/chat_app">Chat-App Tutorial</a>
      <a href="/tutorials/hyperreact_with_rails">HyperReact and Rails Tutorial</a>
      <a href="/tutorials/hyperreact_with_webpack">NPM and Webpack Tutorial</a>
      <a href="/tutorials/flux_store">Flux Store Tutorial</a>
      <a href="/tutorials/file_uploader">File Uploader Tutorial</a>
    </div>
    <div>
      <h6><a href="/installation">Install</a></h6>
      <a href="#opal-playground">Opal Playground</a>
	  <a href="#using-hyperloop-express">Using Hyperloop Express</a>
	  <a href="#with-rails">With Rails</a>
	  <a href="#manual-rails-install">Manual Rails Install</a>
	  <a href="#with-sinatra">With Sinatra</a>
	  <a href="#building-with-rake">Building with Rake</a>
	  <a href="#deployment">Deployment</a>
    </div>
    <div>
      <h6><a href="/gems">Gems</a></h6>
      <a href="https://github.com/ruby-hyperloop/hyper-rails">hyper-rails</a>
      <a href="https://github.com/ruby-hyperloop/reactrb-express">hyperloop-express</a>
      <a href="https://github.com/ruby-hyperloop/hyper-react">hyper-component</a>
      <a href="https://github.com/ruby-hyperloop/hyper-store">hyper-store</a>
      <a href="https://github.com/ruby-hyperloop/hyper-mesh">hyper-model</a>
      <a href="https://github.com/ruby-hyperloop/hyper-operation">hyper-operation</a>
      <a href="https://github.com/ruby-hyperloop/reactrb-router/tree/v2-4-0">hyper-router</a>
      <a href="https://github.com/ruby-hyperloop/hyper-spec">hyper-spec</a>
      <a href="https://github.com/ruby-hyperloop/hyper-trace">hyper-trace</a>
    </div>
    <div>
      <h6><a href="/tools">Tools</a></h6>
      <a href="#testing">Testing</a>
    	<a href="#tools">Tools</a>
    	<a href="#debugging">Debugging</a>
    </div>
    <div>
      <h6><a href="/docs/architecture">Docs</a></h6>
      <a href="/docs/architecture">Hyperloop Architecture</a>
      <a href="/docs/components/dsl-overview">Components</a>
      <a href="/docs/stores/overview">Stores</a>
      <a href="/docs/models/overview">Models</a>
      <a href="/docs/operations/overview">Operations</a>
      <a href="/docs/policies/authorization">Policies</a>
    </div>

  </section>
  
  <section class="otherlinks">
    <a href="https://github.com/ruby-hyperloop">Github</a>
    <a href="/support">Help</a>
    <a href="/blog">Blog</a>
  </section>

  <section class="copyright">
    Copyright Â© 2017 Hyperloop.
  </section>
</footer>


    <script>
      (function(Opal) {
        var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;
        Opal.add_stubs(['$puts']);
        return self.$puts("Opal ok")
      })(Opal);
    </script>

    <!-- <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->

    <script type="text/ruby">puts "Hyperloop Express ok"</script>

  </body>
</html>
