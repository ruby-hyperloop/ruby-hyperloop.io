<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop - Components</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://unpkg.com/react@15/dist/react.min.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.min.js"></script>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.5/marked.min.js"></script>


    <!-- Opal and Hyperloop -->
    <script src="https://rawgit.com/ruby-hyperloop/hyperloop-js/master/opal-compiler.min.js"></script>
    <script src="https://rawgit.com/ruby-hyperloop/hyperloop-js/master/hyperloop.min.js"></script>

    <!-- If you want local copies... -->
    <!-- <script src="../../../javascripts/opal-compiler.js"></script> -->
    <!-- <script src="../../../javascripts/hyperloop.js"></script> -->

    <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>

    <script src="../../../javascripts/bootstrap.min.js"></script>
    <script src="../../../javascripts/codemirror.js"></script>
    <script src="../../../javascripts/ruby.js"></script>
    <script src="../../../javascripts/matchbrackets.js"></script>
    <script src="../../../javascripts/react_player.js"></script>

    <!-- Components are compiled by Hyperloop Express -->
    <script type="text/ruby">

class CodeMirror < Hyperloop::Component
  param :code, type: String
  param :heading, default: "Code"
  param :rows, type: Integer, default: 0
  param :top_level_component, type: String

  before_mount do
    r=rand(2**256).to_s(36)[0..7]
    @div_code = "code_#{r}"
    @div_result = "result_#{r}"
  end

  after_mount do
  # puts params.code
    @editor = `CodeMirror(document.getElementById(#{@div_code}), {
      value: #{params.code.to_s},
      mode: 'text/x-ruby',
      matchBrackets: true,
      lineNumbers: true,
      indentUnit: 2,
      theme: 'github'
    });`

    `#{@editor}.on('change', #{lambda {on_change} })`
    `#{@editor}.setSize(null, #{@editor}.defaultTextHeight()*#{params.rows})` unless params.rows == 0
    execute_code
  end

  render(DIV) do
    div.card {
      div.card_header { params.heading }
      div(id: @div_code)
      div.card_header do
        img(src: '../../../images/hyperloop-logo-small-white.png' , width:'25')
        span { ' ' }
        'Hyperloop playground :'
      end
      div.card_block(id: @div_result)
    }
  end

  def on_change
    execute_code
  end

  def execute_code
    begin
      code = `#{@editor}.getValue()`
      # puts code
      code += "\nElement['##{@div_result}'].render(#{params.top_level_component})"
      compiled_code = Opal::Compiler.new(code).compile

      `ReactDOM.unmountComponentAtNode(document.getElementById(#{@div_result}));`

      Hyperloop::Context.reset!
      `eval(#{compiled_code})`
      Hyperloop::Application::Boot.run()

      
      component = Module.const_get params.top_level_component
      # we need to see if the component is valid - try checking if it can render static markup
      # the following line generates: `undefined method to_n for SimpleComponent`
      # if React.render_to_static_markup( component ).empty?
      #   invalid_component_message
      # end
    rescue Exception => e
      @time_out = after(0.1) do
        unable_to_compile_message e.message
      end
    end
  end

  def invalid_component_message
    message = div.text_danger do
      h3.text_danger {"Oops, invalid Component..."}
      p { "Your Component has been rejected by React. A valid Component must have a render macro and return just one HTML element." }
    end
    Element["##{@div_result}"].render{ message }
  end

  def unable_to_compile_message reason
    message = div.text_danger do
      h3.text_danger {"Can't compile..."}
      p { reason }
    end
    Element["##{@div_result}"].render{ message }
  end

end

</script>

    <script type="text/ruby">

Document.ready? do
   Element.find('div.codemirror-live-edit').each do |mount_point|
     heading = mount_point.attr('data-heading')
     rows = mount_point.attr('data-rows')
     top_level_component = mount_point.attr('data-top-level-component')
     code = Element[mount_point].find('pre').text.strip
     params = {code: code, top_level_component: top_level_component}
     params = params.merge({heading: heading}) if heading
     params = params.merge({rows: rows.to_i}) if rows
     codemirror_component = Object.const_get('CodeMirror')
     React.render(React.create_element(codemirror_component, params ), mount_point)
   end
end

</script>


    <link href="../../../stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="../../../stylesheets/typography.css" rel="stylesheet" />
    <link href="../../../stylesheets/override.css" rel="stylesheet" />
    <link href="../../../stylesheets/divtable.css" rel="stylesheet" />
    <!-- <link href="../../../stylesheets/code.css" rel="stylesheet" /> -->
    <link href="../../../stylesheets/github.css" rel="stylesheet" />
    <link href="../../../stylesheets/highlighting.css" rel="stylesheet" />
    <link href="../../../stylesheets/codemirror.css" rel="stylesheet" />

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->

    <link rel="apple-touch-icon" sizes="180x180" href="../../../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="../../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../images/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/images/manifest.json">
    <link rel="mask-icon" href="../../../images/safari-pinned-tab.svg" color="#e81176">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
    <div class="navbarbackgroundcolor">
      <div class="container">
        <nav class="navbar navbar-ligh">
  <button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2" aria-controls="exCollapsingNavbar2" aria-expanded="false" aria-label="Toggle navigation">
    &#9776;
  </button>
  <div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2">
    <ul class="nav navbar-nav">
      <li class="nav-item">
        <a href="/" class="nav-link">Hyperloop</a>
      </li>
      <li class="nav-item">
        <a href="/start/components" class="nav-link active">Start</a>
      </li>
      <li class="nav-item">
        <a href="/installation" class="nav-link">Installation</a>
      </li>
      <li class="nav-item">
        <a href="/tutorials" class="nav-link">Tutorials</a>
      </li>
      <li class="nav-item">
        <a href="/gems" class="nav-link">Gems</a>
      </li>
      <li class="nav-item">
        <a href="https://github.com/ruby-hyperloop" class="nav-link">Github</a>
      </li>
      <li class="nav-item">
        <a href="/tools" class="nav-link">Tools</a>
      </li>
      <li class="nav-item">
        <a href="/docs/architecture" class="nav-link">Docs</a>
      </li>
      <li class="nav-item">
        <a href="/help" class="nav-link">Help</a>
      </li>
      <li class="nav-item">
        <a href="/blog" class="nav-link">Blog</a>
      </li>
    </ul>
  </div>
</nav>

      </div>
    </div>

    <div class="jumbotron page-header">
      <div class="container">

        <div class="row hidden-sm-down">
          <div class="col-md-2">
            <div class="hyperlooplogo">
            </div>
          </div>
          <div class="col-md-6">

            <h1 class="display-4 project-name">Hyperloop</h1>

            <h4 class="display-7 project-tagline">
              Components
            </h4>
          </div>
          <div class="col-md-4">
            <div class="row underconstruction">
              <div class="col-sm-4">
                <img src="../../../images/underconstruction.png" width="120" alt="Underconstruction" />
              </div>
              <div class="col-sm-8 underconstructiontext">
                 Docs and Tutorials are under construction but GEMS are released and all passing tests
              </div>
            </div>
          </div>
        </div>

        <div class="row hidden-md-up">
          <div class="col-md-3 center-text">
            <img src="../../../images/hyperloop-logo-small-white.png" width="100" alt="Hyperloop logo small white" />
          </div>
          <div class="col-md-9">
            <h1 class="h1 project-name center-text">Hyperloop</h1>
            </br>
            <h2 class="h5 project-tagline center-text">
              Components
            </h2>
          </div>
          <div class="col-sm-12">
          <br>
            <div class="row underconstruction">
              <div class="col-sm-4">
                <img src="../../../images/underconstruction.png" width="120" alt="Underconstruction" />
              </div>
              <div class="col-sm-8 underconstructiontext">
                 Docs and Tutorials are under construction but GEMS are released and all passing tests
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>

    <div class="page-header-underline">
      <div class="container">

      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-3 sidenavcol">
            <ul class="nav">
    <li class="nav-item"><a href="/docs/architecture">Hyperloop Architecture</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/architecture#comps-overview">COMPS Overview</a></li>
      <li class="nav-item"><a href="/docs/architecture#pragmatic-thinking">Pragmatic Thinking</a></li>
      <li class="nav-item"><a href="/docs/advancedconfiguration">Advanced configuration</a></li>
    </ul>
  </ul>

  <br>
  <ul class="nav">
    <li class="nav-item"><a href="/docs/components/dsl-overview">Components</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/components/components-and-state">Components and State</a></br></li>
      <li class="nav-item"><a href="/docs/components/lifecycle-callbacks">Lifecycle Callbacks</a></br></li>
      <li class="nav-item"><a href="/docs/components/lifecycle-methods">Lifecycle Methods</a></br></li>
      <li class="nav-item"><a href="/docs/components/event-handelers">Event Handelers</a></br></li>
      <li class="nav-item"><a href="/docs/components/elements-rendering">Elements and Rendering</a></br></li>
      <li class="nav-item"><a href="/docs/components/javascript-components">Javascript Components</a></br></li>
      <li class="nav-item"><a href="/docs/components/further-reading">Further Reading</a></br></li>
    </ul>
  </ul>

  <br>
  <ul class="nav">
    <li class="nav-item"><a href="/docs/stores/overview">Stores</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/stores/overview#receiving-operation-dispatches">Receiving Operation Dispatches</a></li>
      <li class="nav-item"><a href="/docs/stores/overview#reading-and-mutating-states">Reading and Mutating States</a></li>
      <li class="nav-item"><a href="/docs/stores/overview#instances-and-classes">Instances and Classes</a></li>
      <li class="nav-item"><a href="/docs/stores/overview#explicitly-declaring-states">Explicitly Declaring States</a></li>
      <li class="nav-item"><a href="/docs/stores/overview#hyperloop-store-mixin">Store Mixin</a></li>
    </ul>
  </ul>

  <br>
  <ul class="nav">
    <li class="nav-item"><a href="/docs/models/overview">Models</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/models/active-record">ActiveRecord API</a></li>
      <li class="nav-item"><a href="/docs/models/scoping">Scoping</a></br></li>
      <li class="nav-item"><a href="/docs/models/configuring-transport">Configuring the Transort</a></li>
      <li class="nav-item"><a href="/docs/models/debugging">Debugging</a></li>
      <li class="nav-item"><a href="/docs/models/common-errors">Common Errors</a></li>
    </ul>
  </ul>

  <br>
  <ul class="nav">
    <li class="nav-item"><a href="/docs/operations/overview">Operations</a></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/operations/overview#flux-and-operations">Flux and Operations</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#defining-execution-steps">Defining Execution Steps</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#promises-and-operations">Promises and Operations</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#early-exits">Early Exits</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#validation">Validation</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#handling-failed-operations">Handling Failed Operations</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#running-operations">Running Operations</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#server-operations">Server Operations</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#dispatching-from-server-operations">Dispatching From ServerOps</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#channels">Channels</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#defining-connections-in-serverops">Defining Connections</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#regulating-dispatches-in-policy-classes">Regulating Dispatches</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#serialization">Serialization</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#dispatching-with-new-parameters">Dispatching New Parameters</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#instance-verses-class-execution-context">Execution Context</a></li>
      <li class="nav-item"><a href="/docs/operations/overview#the-boot-operation">The Boot Operation</a></li>
    </ul>
  </ul>

  <br>
  <ul class="nav">
    <li class="nav-item"><strong><a href="/docs/policies/authorization">Policies</a></strong></li>
    <ul class="nav">
      <li class="nav-item"><a href="/docs/policies/authorization#details">Details</a></li>
    </ul>
  </ul>


          <br>
        </div>
        <div class="col-md-9 main-content">
          <h2 id="components-dsl-overview">Components DSL Overview</h2>

<p>Hyperloop <strong>Components</strong> are implemented in the <strong>HyperComponent Gem</strong>.</p>

<p>Hyperloop Component DSL (Domain Specific Language) is a set of class and instance methods that are used to describe your React components.</p>

<ul>
<li><a href="#hyperloop-component">Hyperloop::Component</a></li>
<li><a href="#macros-class-methods">Macros (Class Methods)</a></li>
<li><a href="#data-accessor-methods">Data Accessor Methods</a></li>
<li><a href="#tag-and-component-rendering">Tag and Component Rendering</a></li>
<li><a href="#using-strings">Using Strings</a></li>
<li><a href="#haml-style-class-names">HAML style class names</a></li>
<li><a href="#event-handlers">Event Handlers</a></li>
<li><a href="#miscellaneous-methods">Miscellaneous Methods</a></li>
<li><a href="#ruby-and-hyperloop">Ruby and Hyperloop</a></li>
<li><a href="#dsl-gotchas">DSL Gotchas</a></li>
</ul>

<p>The DSL has the following major areas:  </p>

<ul>
<li>The <code>Hyperloop::Component</code> class and the equivilent <code>Hyperloop::Component::Mixin</code> mixin.</li>
<li>Class methods or <em>macros</em> that describe component class level behaviors.</li>
<li>The four data accessors methods: <code>params</code>, <code>state</code>, <code>mutate</code>, and <code>children</code>.</li>
<li>The tag and component rendering methods.</li>
<li>Event handlers.</li>
<li>Miscellaneous methods.</li>
</ul>

<p>To understand the DSL we will walk through an example that will cover each of these areas in detail.</p>

<div class="codemirror-live-edit"
  data-heading="Clock"
  data-rows=35
  data-top-level-component="Clock">
<pre>
class Clock < Hyperloop::Component

  param initial_mode: 12

  before_mount do
    mutate.mode params.initial_mode
  end

  after_mount do
    @timer = every(1) { force_update! }
  end

  before_unmount do
    @timer.stop
  end

  FORMATS = {
    12 => "%a, %e %b %Y %S %I:%M %p",
    24 => "%a, %e %b %Y %S %H:%M"
    }

  render do
    div(class: :time) do
      Time.now.strftime(FORMATS[state.mode]).span
      select(style: {"margin-left" => 20}, value: state.mode)  do
        option(value: 12) { "12 Hour Clock" }
        option(value: 24) { "24 Hour Clock" }
      end.on(:change) do |e|
        mutate.mode(e.target.value.to_i)
      end
    end
  end
end
</pre></div>

<h3 id="hyperloop-component">Hyperloop::Component</h3>

<p>Hyperloop Components classes either include <code>Hyperloop::Component::Mixin</code> or are subclasses of <code>Hyperloop::Component</code>.  </p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Component</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
<span class="k">end</span>

<span class="c1"># if subclassing is inappropriate, you can mixin instead</span>
<span class="k">class</span> <span class="nc">AnotherComponent</span>
  <span class="kp">include</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span><span class="o">::</span><span class="no">Mixin</span>
<span class="k">end</span>
</code></pre>
<p>At a minimum every component class must define a <code>render</code> macro which returns <strong>one single</strong> child element. That child may in turn have an arbitrarily deep structure.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Component</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span> <span class="k">do</span>
    <span class="n">div</span> <span class="c1"># render an empty div</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>You may also include the top level element to be rendered:</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Component</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span><span class="p">(</span><span class="no">DIV</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># everything will be rendered in a dic</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>To render a component, you reference its class name in the DSL as a method call.  This creates a new instance, passes any parameters proceeds with the component lifecycle.  </p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">AnotherComponent</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">render</span> <span class="k">do</span>
    <span class="no">Component</span><span class="p">()</span> <span class="c1"># ruby syntax requires either () or {} following the class name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<p>Note that you should never redefine the <code>new</code> or <code>initialize</code> methods, or call them directly.  The equivilent of <code>initialize</code> is the <code>before_mount</code> callback.  </p>

<h3 id="macros-class-methods">Macros (Class Methods)</h3>

<p>Macros specify class wide behaviors.  In our example we use the five most common macros.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Clock</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">param</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">before_mount</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">after_mount</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">before_unmount</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">render</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">.</span><span class="p">.</span><span class="nf">.</span>
<span class="k">end</span>
</code></pre>
<p>The <code>param</code> macro describes the parameters the component expects.</p>

<p>The <code>before_mount</code> macro defines code to be run (a callback) when a component instance is first initialized.</p>

<p>The <code>after_mount</code> macro likewise runs after the instance has completed initialization, and is visible in the DOM.</p>

<p>The <code>before_unmount</code> macro provides any cleanup actions before the instance is destroyed.</p>

<p>The <code>render</code> macro defines the render method.</p>

<p>The available macros are: <code>render, param, state, mutate, before_mount, after_mount, before_receive_props, before_update, after_update, before_unmount</code></p>

<h3 id="data-accessor-methods">Data Accessor Methods</h3>

<p>The four data accessor methods - <code>params, state, mutate, and children</code> are instance methods that give access to a component&#39;s React specific instance data.</p>

<p>The <code>params</code> method gives (read only) access to each of the params passed to this instance, the <code>state</code> method allows state variables to be read and written, and <code>children</code> returns an enumerator of a component&#39;s children.</p>

<p>In our example we see</p>
<pre class="highlight ruby"><code>  <span class="n">before_mount</span> <span class="k">do</span>
    <span class="n">mutate</span><span class="p">.</span><span class="nf">mode</span> <span class="n">params</span><span class="p">.</span><span class="nf">mode</span>
  <span class="k">end</span>
</code></pre>
<p><code>params.mode</code> will return the value of the <code>mode</code> parameter passed to this instance, and <code>mutate.mode</code> initializes (or updates) the <code>mode</code> state variable.  State variables are like <em>reactive</em> instance variables.  They can only be changed using the <code>mutate</code> method, and when they change they will cause a rerender.  </p>

<p>More on the details of these methods can be found in the <a href="#top-level-api">Component API</a> section.</p>

<h3 id="tag-and-component-rendering">Tag and Component Rendering</h3>
<pre class="highlight ruby"><code>  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
    <span class="nf">div</span><span class="p">(</span><span class="ss">class: :time</span><span class="p">)</span> <span class="k">do</span>
      <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
    <span class="nf">end</span>
  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>
</code></pre>
<p>HTML such as <code>div, a, select, option</code> etc. each have a corresponding instance method that will render that tag.  For all the tags the
method call looks like this:</p>
<pre class="highlight ruby"><code><span class="n">tag_name</span><span class="p">(</span><span class="n">attribute1</span> <span class="o">=&gt;</span> <span class="n">value1</span><span class="p">,</span> <span class="n">attribute2</span> <span class="o">=&gt;</span> <span class="n">value2</span> <span class="p">.</span><span class="nf">.</span><span class="o">.</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span><span class="nf">nested</span> <span class="n">tags</span><span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<p>Each key-value pair in the parameter block is passed down as an attribute to the tag as you would expect, with the exception of the <code>style</code> attribute, which takes a hash that is translated to the corresponding style string.</p>

<p>The same rules apply for application defined components, except that the class constant is used to reference the component.</p>
<pre class="highlight ruby"><code><span class="no">Clock</span><span class="p">(</span><span class="ss">mode: </span><span class="mi">12</span><span class="p">)</span>
</code></pre>
<h3 id="using-strings">Using Strings</h3>

<p>Strings are treated specially as follows:  </p>

<p>If a render method or a nested tag block returns a string, the string is automatically wrapped in a <code>&lt;span&gt;</code> tag.</p>

<p>The code <code>span { &quot;hello&quot; }</code> can be shortened to <code>&quot;hello&quot;.span</code>, likewise for <code>td, para, td, th</code> tags.</p>

<p><code>&quot;some string&quot;.br</code> generates <code>&lt;span&gt;some string&lt;span&gt;&lt;br/&gt;</code></p>
<pre class="highlight ruby"><code><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="no">FORMATS</span><span class="p">[</span><span class="n">state</span><span class="p">.</span><span class="nf">mode</span><span class="p">]).</span><span class="nf">span</span>  <span class="c1"># generates &lt;span&gt;...current time formatted...&lt;/span&gt;</span>
<span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">option</span><span class="p">(</span><span class="ss">value: </span><span class="mi">12</span><span class="p">)</span> <span class="p">{</span> <span class="s2">"12 Hour Clock"</span> <span class="p">}</span>      <span class="c1"># generates &lt;option value=12&gt;&lt;span&gt;12 Hour Clock&lt;/span&gt;&lt;/option&gt;</span>
</code></pre>
<h3 id="haml-style-class-names">HAML style class names</h3>

<p>Any tag or component name can be followed by <code>.class_name</code> HAML style.</p>
<pre class="highlight ruby"><code><span class="n">div</span><span class="p">.</span><span class="nf">class1</span><span class="p">.</span><span class="nf">class2</span>
  <span class="c1"># short for</span>
<span class="n">div</span><span class="p">(</span><span class="ss">class: </span><span class="s2">"class1 class2"</span><span class="p">)</span>
</code></pre>
<p>Note that underscores are translated to dashes.  So <code>.foo_bar</code> will add the <code>foo-bar</code> class to the tag.  If you need to use an underscore in a class name use a double underscore which will be translated to a single underscore in the class name.</p>

<h3 id="event-handlers">Event Handlers</h3>

<p>Event Handlers are attached to tags and components using the <code>on</code> method.</p>
<pre class="highlight ruby"><code><span class="nb">select</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span> <span class="nf">do</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:change</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="n">mutate</span><span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">target</span><span class="p">.</span><span class="nf">value</span><span class="p">.</span><span class="nf">to_i</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>The <code>on</code> method takes the event name symbol (note that <code>onClick</code> becomes <code>:click</code>) and the block is passed the React.js event object.</p>

<p>Event handlers can be chained like so</p>
<pre class="highlight ruby"><code><span class="n">input</span> <span class="p">.</span><span class="nf">.</span><span class="p">.</span> <span class="nf">do</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:key_up</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
  <span class="nf">end</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:change</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span>
  <span class="p">.</span><span class="nf">.</span><span class="p">.</span>
<span class="nf">end</span>
</code></pre>
<h3 id="miscellaneous-methods">Miscellaneous Methods</h3>

<p><code>force_update!</code> is a component instance method that causes the component to re-rerender.</p>

<p><code>as_node</code> can be attached to a component or tag, and removes the element from the rendering buffer and returns it.   This is useful when you need store an element in some data structure, or passing to a native JS component.  When passing an element to another Hyperloop Component <code>.as_node</code> will be automatically applied so you normally don&#39;t need it.  </p>

<p><code>render</code> can be applied to the objects returned by <code>as_node</code> and <code>children</code> to actually render the node.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">Test</span> <span class="o">&lt;</span> <span class="no">Hyperloop</span><span class="o">::</span><span class="no">Component</span>
  <span class="n">param</span> <span class="ss">:node</span>
  <span class="n">render</span> <span class="k">do</span>
    <span class="n">div</span> <span class="k">do</span>
      <span class="n">children</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
        <span class="n">params</span><span class="p">.</span><span class="nf">node</span><span class="p">.</span><span class="nf">render</span>
        <span class="n">child</span><span class="p">.</span><span class="nf">render</span>
      <span class="k">end</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">node</span><span class="p">.</span><span class="nf">render</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<h3 id="ruby-and-hyperloop">Ruby and Hyperloop</h3>

<p>A key design goal of the DSL is to make it work seamlessly with the rest of Ruby.  Notice in the above example, the use of constant declaration (<code>FORMATS</code>), regular instance variables (<code>@timer</code>), and other non-react methods like <code>every</code> (an Opal Browser method).  </p>

<p>Component classes can be organized like any other class into a logical module hierarchy or even subclassed.</p>

<p>Likewise the render method can invoke other methods to compute values or even internally build tags.</p>

<h3 id="dsl-gotchas">DSL Gotchas</h3>

<p>There are few gotchas with the DSL you should be aware of:</p>

<p>React has implemented a browser-independent events and DOM system for performance and cross-browser compatibility reasons. We took the opportunity to clean up a few rough edges in browser DOM implementations.</p>

<ul>
<li>All DOM properties and attributes (including event handlers) should be snake_cased to be consistent with standard Ruby style. We intentionally break with the spec here since the spec is inconsistent. <strong>However</strong>, <code>data-*</code> and <code>aria-*</code> attributes <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes#data-*">conform to the specs</a> and should be lower-cased only.</li>
<li>The <code>style</code> attribute accepts a Hash with camelCased properties rather than a CSS string. This  is more efficient, and prevents XSS security holes.</li>
<li>All event objects conform to the W3C spec, and all events (including submit) bubble correctly per the W3C spec. See <a href="#event-handling-and-synthetic-events">Event System</a> for more details.</li>
<li>The <code>onChange</code> event (<code>on(:change)</code>) behaves as you would expect it to: whenever a form field is changed this event is fired rather than inconsistently on blur. We intentionally break from existing browser behavior because <code>onChange</code> is a misnomer for its behavior and React relies on this event to react to user input in real time.</li>
<li>Form input attributes such as <code>value</code> and <code>checked</code>, as well as <code>textarea</code>.</li>
</ul>

<h4 id="html-entities">HTML Entities</h4>

<p>If you want to display an HTML entity within dynamic content, you will run into double escaping issues as React.js escapes all the strings you are displaying in order to prevent a wide range of XSS attacks by default.</p>
<pre class="highlight ruby"><code><span class="n">div</span> <span class="p">{</span><span class="s1">'First &amp;middot; Second'</span> <span class="p">}</span>
  <span class="c1"># Bad: It displays "First &amp;middot; Second"</span>
</code></pre>
<p>To workaround this you have to insert raw HTML.</p>
<pre class="highlight ruby"><code><span class="n">div</span><span class="p">(</span><span class="ss">dangerously_set_inner_HTML: </span><span class="p">{</span> <span class="ss">__html: </span><span class="s2">"First &amp;middot; Second"</span><span class="p">})</span>
</code></pre>
<h4 id="custom-html-attributes">Custom HTML Attributes</h4>

<p>If you pass properties to native HTML elements that do not exist in the HTML specification, React will not render them. If you want to use a custom attribute, you should prefix it with <code>data-</code>.</p>
<pre class="highlight ruby"><code><span class="n">div</span><span class="p">(</span><span class="s2">"data-custom-attribute"</span> <span class="o">=&gt;</span> <span class="s2">"foo"</span><span class="p">)</span>
</code></pre>
<p><a href="http://www.w3.org/WAI/intro/aria">Web Accessibility</a> attributes starting with <code>aria-</code> will be rendered properly.</p>
<pre class="highlight ruby"><code><span class="n">div</span><span class="p">(</span><span class="s2">"aria-hidden"</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>
</code></pre>
<h4 id="invoking-application-components">Invoking Application Components</h4>

<p>When invoking a custom component you must have a (possibly empty) parameter list or (possibly empty) block.  This is not necessary
with standard html tags.</p>
<pre class="highlight ruby"><code><span class="no">MyCustomComponent</span><span class="p">()</span>  <span class="c1"># okay</span>
<span class="no">MyCustomComponent</span> <span class="p">{}</span> <span class="c1"># okay</span>
<span class="no">MyCustomComponent</span>    <span class="c1"># breaks</span>
<span class="n">br</span>                   <span class="c1"># okay</span>
</code></pre>
        </div>
      </div>
    </div>

    <div class="page-footer-upperline">
      <div class="container">

      </div>
    </div>

    <footer class="nav-footer">
  <section class="sitemap">

    <a href="/" class="nav-home"></a>

    <div>
      <h6><a href="/start/components" class="hyperloop-white">Start</a></h6>
      <a href="/start/components#components">Components</a>
      <a href="/start/stores#stores">Stores</a>
      <a href="/start/operations#operations">Operations</a>
      <a href="/start/policies#policies">Policies</a>
      <a href="/start/pradgmatic">Pragmatic Thinking</a>
    </div>
    <div>

    
      <h6><a href="/tutorials" class="hyperloop-white">Tutorials</a></h6>
      <a href="/tutorials/hyperloopcomps">Hyperloop COMPS</a>
      <a href="/tutorials/hyperloopjs">Hyperloop.js</a>
      <a href="/tutorials/hyperlooprails">Hyperloop and Rails</a>
      <a href="/tutorials/hyperloopdeploy">Hyperloop deployment</a>
      <a href="/tutorials/opal">Opal</a>
      <a href="/tutorials/videos">Videos</a>
    </div>
    <div>
      <h6><a href="/installation" class="hyperloop-white">Installation</a></h6>
      <a href="installation#opal-playground">Hyperloop.js</a>
  	  <a href="installation#ror">With Ruby On Rails</a>
  	  <a href="installation#with-sinatra">With Sinatra</a>
  	  <a href="installation#deployment">Deployment</a>
    </div>
    <div>
      <h6><a href="/gems" class="hyperloop-white">Gems</a></h6>
      <a href="https://github.com/ruby-hyperloop/hyperloop">hyperloop</a>
      <a href="https://github.com/ruby-hyperloop/hyperloop-js">hyperloop-js</a>
      <a href="https://github.com/ruby-hyperloop/hyper-react">hyper-component</a>
      <a href="https://github.com/ruby-hyperloop/hyper-store">hyper-store</a>
      <a href="https://github.com/ruby-hyperloop/hyper-mesh">hyper-model</a>
      <a href="https://github.com/ruby-hyperloop/hyper-operation">hyper-operation</a>
      <a href="https://github.com/ruby-hyperloop/reactrb-router/tree/v2-4-0">hyper-router</a>
      <a href="https://github.com/ruby-hyperloop/hyper-spec">hyper-spec</a>
      <a href="https://github.com/ruby-hyperloop/hyper-trace">hyper-trace</a>
    </div>
    <div>
      <h6><a href="/tools" class="hyperloop-white">Tools</a></h6>
      <a href="#testing">Testing</a>
    	<a href="#tools">Tools</a>
    	<a href="#debugging">Debugging</a>
    </div>
    <div>
      <h6><a href="/docs/architecture" class="hyperloop-white">Docs</a></h6>
      <a href="/docs/architecture">Hyperloop Architecture</a>
      <a href="/docs/components/dsl-overview">Components</a>
      <a href="/docs/stores/overview">Stores</a>
      <a href="/docs/models/overview">Models</a>
      <a href="/docs/operations/overview">Operations</a>
      <a href="/docs/policies/authorization">Policies</a>
    </div>

  </section>

  <section class="otherlinks">
    <a href="https://github.com/ruby-hyperloop" class="hyperloop-white">Github</a>
    <a href="/support" class="hyperloop-white">Help</a>
    <a href="/blog" class="hyperloop-white">Blog</a>
  </section>

  <section class="copyright">
    Copyright Â© 2017 Hyperloop.
  </section>
</footer>


    <script>
      (function(Opal) {
        var self = Opal.top, $scope = Opal, nil = Opal.nil, $breaker = Opal.breaker, $slice = Opal.slice;
        Opal.add_stubs(['$puts']);
        return self.$puts("Opal ok")
      })(Opal);
    </script>

    <!-- <script   src="http://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->


    <script type="text/ruby">puts "Hyperloop JS ok"</script>


  </body>
</html>
